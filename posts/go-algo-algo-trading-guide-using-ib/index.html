<!doctype html><html><head><title>Go Algo - Algo trading guide using IB</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600"><link rel=stylesheet href=/fontawesome/css/all.min.css><link rel=stylesheet href=/css/colortheme/colortheme.css><meta property="og:title" content="Go Algo - Algo trading guide using IB"><meta property="og:description" content="Algo Trading Guide Part I"><meta property="og:type" content="article"><meta property="og:url" content="https://prajual.github.io/posts/go-algo-algo-trading-guide-using-ib/"><meta property="article:published_time" content="2021-10-01T07:57:25+06:00"><meta property="article:modified_time" content="2021-10-01T07:57:25+06:00"><meta name=description content="Algo Trading Guide Part I"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/>Prajual's Website</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><div id=theme-initialization style=display:none default-theme=system></div><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg src=/icons/moon-svgrepo-com.svg width=20></a><div class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# onclick=enableLightTheme()><img class=menu-icon-center src=/icons/sun-svgrepo-com.svg width=20></a>
<a class="dropdown-item nav-link" href=# onclick=enableDarkTheme()><img class=menu-icon-center src=/icons/moon-svgrepo-com.svg width=20></a>
<a class="dropdown-item nav-link" href=# onclick=useSystemTheme()><img class=menu-icon-center src=/icons/computer-svgrepo-com.svg width=20></a></div></li></ul></div></div></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>Posts</a></li><div class=subtree><li><a class=active href=/posts/go-algo-algo-trading-guide-using-ib/ title="Go Algo - Algo trading guide using IB">Go Algo - Algo trading guide using IB</a></li><li><a href=/posts/webmail-scraping-using-python/ title="Webmail-scraping using Python">Webmail-scraping using Python</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/posts/go-algo-algo-trading-guide-using-ib/hero.png)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/default-avatar_hu3fe91c60b44f33a12221a161d1cb4d35_107142_120x120_fit_box_2.png alt="Author Image"><h5 class=author-name>Prajual Maheshwari</h5><p>:date_full</p></div><div class=title><h1>Go Algo - Algo trading guide using IB</h1></div><div class=post-content id=post-content><p>Hey readers, I am Prajual, currently working at a high-frequency trading firm (better known as HFT’s) and prior to this, I have also worked in a hedge fund. I am starting this series, Go Algo to share whatever I know to help you get started with Algo trading.</p><p>Here I am using Interactive brokers Python API. But the basic idea remains the same across brokers and geographies. You will easily be able to modify these functions and use them for your respective brokers.</p><pre><code>This series assumes that you already have a brokerage account with API services. If you don’t have check this out for IB API. This series is strictly for educational purposes and doesn’t endorse any broker.
</code></pre><p>Two important imports to be used for the complete series (To know more about ib_insync, check this out):</p><p>from ib_insync import IB, Stock, Option
from ib_insync import util</p><p>Part I: Establish connection to the broker</p><p>To get started with algo-trading, the very first step always involves connecting to your broker through API. Once connected, we can use all the in-built API functions to perform our trading operations. So, let’s connect using the following code:</p><p>class ConnectAPI(): def <strong>init</strong>(self, *args, **kwargs):
self.host = # Your host
self.port = port ##{&lsquo;Pseudo testing&rsquo;:7496, &lsquo;Live trading&rsquo;: 7497}
self.client_id = # Your client id self.__ib = None
super().<strong>init</strong>(*args, **kwargs) def connect_to_ib(self):
self.ib.connect(self.host, self.port, clientId=self.client_id)</p><p>@property
def ib(self):
if not self.__ib:
self.__ib = IB()
return self.__ib</p><p>Here I have created a ConnectAPI class with basic implementation to connect to IB API.</p><p>Further you will need to create an object of this class and call the corresponding function as:</p><p>if <strong>name</strong> == ‘<strong>main</strong>’:
API = ConnectAPI()
API.connect_to_ib()</p><p>Now we are connected to IB API and can easily steer our trading experience algorithmically.
Part II: Fetch some historical data</p><p>Let’s start with a very important aspect of algo-trading, fetching historical data to develop our strategies. This simple piece of code, can be used for the above purpose:</p><p>symbol = ‘SPX’ ## Collect data for SPX index
contract = Index(symbol, exchange = ‘CBOE’,currency = ‘USD’)
bars = self.ib.reqHistoricalData(
contract, endDateTime=””, durationStr = “5 Y”,
barSizeSetting = “1 day”, whatToShow=’TRADES’, useRTH=True)
self.ib.sleep(25)
data = util.df(bars)</p><p>If we want to fetch the data for some equity, we should create a contract as (rest remains the same):</p><p>contract = Stock(symbol, exchange = ‘SMART’,currency = ‘USD’)</p><p>Here using endDateTime = “”, implies data till the current candle, durationStr specifies the whole time period for data and barSizeSetting gives the size for a candlestick. More details about the function parameter can be found here.
Part III: Placing an Order</p><p>Now, as you have all the data needed and you have also tested your strategy, it is time to trade and place some orders for the same. I’ll deliberately keep this part simple and just talk about placing market and limit orders.</p><p>contract = Option(symbol = symbol,
lastTradeDateOrContractMonth = expiry_date, strike = strike,
right = right, exchange = ‘SMART’)
self.ib.reqMktData(contract, ‘’, False, False)
self.ib.sleep(10)
self.ib.qualifyContracts(contract)
mkt_order = self.ib.marketOrder(&lsquo;BUY&rsquo;, quantity) ## market order
self.ib.placeOrder(contract, mkt_order)option_lmt = round((option_mkt_data.bid + option_mkt_data.ask)/2, 1)
limit_order = self.ib.limitOrder(&lsquo;BUY&rsquo;, quantity,
option_lmt) ## limit order
self.ib.placeOrder(contract, limit_order)</p><p>Here I have only described market and limit orders for Options but it is fairly simple to place multiple types of orders for various instruments, as described here.</p><p>For some complicated orders like Bracket orders (they require both stoploss and target on your position) you can refer to the following code:</p><p>option_lmt = round((option_mkt_data.bid + option_mkt_data.ask)/2, 1)
option_trgt = round(option_lmt + (abs(stock_trgt — stock_lmt)/2),1)
option_stp_lss = round(option_lmt — (abs(stock_lmt — stock_stp_lss)/2),1)
self.ib.qualifyContracts(contract)
bracket = self.ib.bracketOrder(‘BUY’, quantity, option_lmt, option_trgt, option_stp_lss) ### Bracket order
for order in [bracket.parent, bracket.takeProfit,bracket.stopLoss]:
self.ib.placeOrder(contract, order)</p><p>Part IV: Cancelling a live order</p><p>Ability to cancel and modify your orders is central to any strategy. You will need a specific order identifier (order Id in our case) to tell the exchange that you want to modify a particular order. This piece can help you cancel the order:</p><p>cancel_order_id = order_id ### give the order id to be cancelled.
for orders in self.ib.openTrades(): ## get all open orders
if(orders.order.orderId==cancel_order_id or orders.order.parentId==cancel_order_id):
self.ib.cancelOrder(orders.order)</p><p>The above piece can cancel a simple market or limit order as well as a bracket order.</p><p>Conclusion</p><p>Apart from the basic functions I demonstrated, IB API can literally do everything one needs ranging from streaming live data to getting realized or unrealized PnL. So, you can use these API’s as your canvas and soon you will realize that sky is the limit.</p><hr><p>Do share your feedback with me and if you liked this blog post, do give it a clap. Follow me on social media (Instagram, Facebook, and LinkedIn)</p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"></div><div class="col-md-6 btn-improve-page"><a href=https://github.com/prajual/prajual.github.io/edit/main/content/posts/Go%20Algo%20-%20Algo%20trading%20guide%20using%20IB/index.md title="Improve this page" target=_blank rel=noopener><i class="fas fa-code-branch"></i>Improve this page</a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-12 next-article"><a href=/posts/webmail-scraping-using-python/ title="Webmail-scraping using Python" class="btn btn-outline-info"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>Webmail-scraping using Python</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=https://prajual.github.io#about>About</a></li><li class=nav-item><a class=smooth-scroll href=https://prajual.github.io#skills>Skills</a></li><li class=nav-item><a class=smooth-scroll href=https://prajual.github.io#experiences>Experiences</a></li><li class=nav-item><a class=smooth-scroll href=https://prajual.github.io#projects>Projects</a></li><li class=nav-item><a class=smooth-scroll href=https://prajual.github.io#accomplishments>Preparation (Intern and Placements)</a></li><li class=nav-item><a class=smooth-scroll href=https://prajual.github.io#education>Course - Resources</a></li><li class=nav-item><a class=smooth-scroll href=https://prajual.github.io#recent-posts>Recent Posts</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:prajual1391@gmail.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span><span>prajual1391@gmail.com</span></a></li><li><a href=https://github.com/prajual target=_blank rel=noopener><span><i class="fab fa-github"></i></span><span>prajual</span></a></li><li><a href=https://www.linkedin.com/in/prajual target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span><span>Prajual Maheshwari</span></a></li><li><span><i class="fas fa-phone-alt"></i></span><span>+918368468233</span></li></ul></div><div class="col-md-4 col-sm-12"><p>Stay up to date with email notification</p><form method=post action=https://blogtrottr.com><div class=form-group><input type=email class=form-control name=btr_email placeholder="Enter email"><br><input type=hidden name=btr_url value=https://prajual.github.ioindex.xml>
<input type=hidden name=schedule_type value=1>
<small id=emailHelp class="form-text text-muted">By entering your email address, you agree to receive the newsletter of this website.</small>
<button type=submit class="btn btn-info"> Submit</button></div></form></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_2.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2020 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script><script type=text/javascript src=/js/popper.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/navbar.js></script><script type=text/javascript src=/js/plyr.js></script><script type=text/javascript src=/js/main.js></script><script type=text/javascript src=/js/darkreader.js></script><script type=text/javascript src=/js/darkmode-darkreader.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script><script src=/js/single.js></script><script>hljs.initHighlightingOnLoad();</script></body></html>